<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Join Platinum – Operation Remoralization</title>

<link rel="stylesheet" href="/style.css" />

<!-- Stripe JS for on-site Payment Element -->
<script src="https://js.stripe.com/v3/"></script>

<style>
/* Minimal safety styles so you see something even if style.css fails */
body { background:#0f1115; color:#e6e6e6; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
.wrap { max-width: 960px; margin: 40px auto; padding: 24px; }
.card { background:#181c27; border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:20px; }
.row { display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:16px; margin-top:16px; }
.cta { margin-top:16px; padding:12px 20px; border-radius:10px; background:#ffb300; color:#111; font-weight:700; border:0; cursor:pointer; }
.muted { color:#c5c6cf; }
#error { color:#f88; margin-top:10px; min-height:22px; }
@media (max-width: 700px){ .row { grid-template-columns: 1fr; } }
</style>
</head>
<body>
<div class="wrap">
<div class="card">
<h1 style="color:#ffb300;margin:0 0 6px 0;">Join Operation Remoralization – Platinum</h1>
<p class="muted">The accountability tier for people who want real change and visible progress every two weeks.</p>

<div class="row">
<div class="box3 card"> <h3>Bi-Weekly 1:1 Review</h3><p class="muted">Personal feedback + 2-week action plan.</p></div>
<div class="box3 card"> <h3>Daily Micro-Check-Ins</h3><p class="muted">Keep streaks alive without spam.</p></div>
<div class="box3 card"> <h3>Priority Help</h3><p class="muted">Fast answers on workouts, systems, roadblocks.</p></div>
<div class="box3 card"> <h3>Quarterly Challenges</h3><p class="muted">Scoreboards + prizes.</p></div>
<div class="box3 card"> <h3>Member Resources</h3><p class="muted">Templates and trackers.</p></div>
<div class="box3 card"> <h3>Community Access</h3><p class="muted">Value-aligned accountability.</p></div>
</div>

<p style="margin-top:16px;"><strong style="color:#ffb300">$10/month</strong> · cancel anytime · 30-day money-back guarantee</p>

<!-- Optional email to tag the Stripe Customer -->
<label for="email1" class="muted" style="display:block;margin-top:10px;">Email for receipt/account (optional)</label>
<input id="email1" type="email" placeholder="you@example.com"
style="margin-top:6px;padding:10px;border-radius:8px;border:1px solid #333;background:#0f1115;color:#e6e6e6;width:100%;max-width:420px;" />

<!-- Payment Element mounts here -->
<div id="payment-box" class="card" style="margin-top:16px;">
<div id="payment-element"></div>
<div id="error"></div>
<button id="submit" class="cta">Join Platinum Now</button>
</div>

<div style="margin-top:14px;"><a href="/index.html" class="muted">Back to Home</a></div>
</div>
</div>

<script>
// PUBLISHABLE key only (never the secret key)
const stripe = Stripe('pk_live_51KQiEQEAIfxpksnpRrLuZnv59jHo2nGBILCc9ojzCrODM5QsPdznCtsiTWdwOpeo1MhVpZSdPjfe2ce5vyeXPLZ000UXBLFb9o'); // <-- your publishable key

let elements, customerId, paymentElement;

function showErr(msg){ document.getElementById('error').textContent = msg || ''; }

async function init() {
try {
const email = (document.getElementById('email1')?.value || '').trim() || undefined;
const res = await fetch('/api/create-setup-intent', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ email })
});
const data = await res.json();
if (!res.ok || !data.clientSecret) return showErr(data.error || 'Failed to initialize payment.');

customerId = data.customerId;

elements = stripe.elements({ clientSecret: data.clientSecret, appearance: { theme: 'night' } });
paymentElement = elements.create('payment');
paymentElement.mount('#payment-element');
} catch (e) {
showErr(e.message || 'Unexpected error while loading payment form.');
}
}

async function onSubmit(e){
e.preventDefault(); showErr('');

const { setupIntent, error } = await stripe.confirmSetup({
elements,
confirmParams: { return_url: window.location.href },
redirect: 'if_required'
});
if (error) return showErr(error.message);

const paymentMethodId = setupIntent.payment_method;

const subRes = await fetch('/api/create-subscription', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ customerId, paymentMethodId })
});
const subData = await subRes.json();
if (!subRes.ok) return showErr(subData.error || 'Subscription creation failed.');

if (subData.clientSecret) {
const pi = await stripe.confirmCardPayment(subData.clientSecret);
if (pi.error) return showErr(pi.error.message);
}

window.location.href = '/success.html';
}

document.addEventListener('DOMContentLoaded', () => {
document.getElementById('submit')?.addEventListener('click', onSubmit);
init();
});
</script>
</body>
</html>
